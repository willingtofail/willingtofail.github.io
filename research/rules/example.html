<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">	<head>		<title>Rails on Rules: Example | Willing To Fail</title>		<meta name="generator" content="Frontier v10.1a10 10.1a10 MacOS" /><meta http-equiv="content-type" content="text/html; charset=utf-8" />		<link rel="stylesheet" href="../../default.css" type="text/css">				<link rel="stylesheet" href="../../nC.css" type="text/css">						</head>	<body bgcolor="#FFFFFF" alink="#008000" vlink="#800080" link="#0000FF" text="#000000">		<div id="page">			<div id="logo"><img src="../../images/wtf-banner-580x130.png" height="130" width="580" id="logo-image" alt="wtf-banner-580x130 picture" border="0"/></div>			<div id="content">				<div id="secondLevelNav"><p>	Rules: <a href="index.html">Home</a> |	<a href="background.html">Background</a> |	<a href="example.html">Example</a> |	<a href="todo.html">To-Do</a> |	<a href="index.html#goals">Goals</a> |	<a href="index.html#plan">Plan</a>	</p></div>								<div id="nCSect1" class="nCSect">				<h1 class="nCLevel0">Rails on Rules: Example</h1>				<div id="nCSect2" class="nCSect">				<h2 class="nCLevel1">June 25, 2007</h2>				<p id="nCSect2Para1" class="nCPara1 nCSectPara1 nCLevel2">I was just speaking with my friend <a href="http://sami.samhuri.net/">Sami Samhuri</a> about use cases for the rule engine.  I imagined this scenario:</p>				<p id="nCSect2Para2" class="nCPara2 nCSectPara2 nCLevel2">You've got a page that lists objects that are authored by many people.  You have [a set of] reusable components/helpers/partials for displaying the objects in the list.</p>				<p id="nCSect2Para3" class="nCPara3 nCSectPara3 nCLevel2">You want edit/delete links to appear for objects that were authored by the current user.  You could imagine something like this in the template that uses the reusable component or in the reusable component itself:</p>				<p id="nCSect2Para4" class="nCPara4 nCSectPara4 nCLevel2">if object.owner == session.current_user { display_edit_and_delete_links }</p>				<p id="nCSect2Para5" class="nCPara5 nCSectPara5 nCLevel2">That's easy to code and maintain, and it can be refactored into a controller without much hassle.</p>				<p id="nCSect2Para6" class="nCPara6 nCSectPara6 nCLevel2">But you might have dozens of pages that list completely unrelated types of objects.  And then you get a requirement to add support for editorial workflow.  Now you need to allow other people to edit/delete the object, not just the owner.  The business rules (you see how this makes sense?) is not longer as simple as "if object.owner == session.current_user", but they do apply application-wide.</p>				<p id="nCSect2Para7" class="nCPara7 nCSectPara7 nCLevel2">Change the "if" check to:</p>				<p id="nCSect2Para8" class="nCPara8 nCSectPara8 nCLevel2">if context.shouldDisplayEditAndDeleteLinks { display_edit_and_delete_links }</p>				<p id="nCSect2Para9" class="nCPara9 nCSectPara9 nCLevel2">Now the business logic is decoupled from the display logic, and the decision making can make augmented without changing application code.  Just provide rules:</p>				<p id="nCSect2Para10" class="nCPara10 nCSectPara10 nCLevel2">Note, the scenario below is simple, clearly a more robust "role" design would be desirable - but part of the point is "role" is an application concept, not a rule engine concept.  Also note the (numbers) next to the rules: these are the priority of the rule, which make it easy to say one rule is more important than another.</p>				<div id="nCSect3" class="nCSect">				<h3 class="nCLevel2">Base rules that specify the role in the current context:</h3>				<p id="nCSect3Para1" class="nCPara11 nCSectPara1 nCLevel3">*true* =&gt; role = 'public' (10)</p>				<p id="nCSect3Para2" class="nCPara12 nCSectPara2 nCLevel3">(session.current_user.is_editor = true) =&gt; role = 'editor' (50)</p>				<p id="nCSect3Para3" class="nCPara13 nCSectPara3 nCLevel3">(session.current_user.is_manager = true) =&gt; role = 'manager' (60)</p>				</div>				<div id="nCSect4" class="nCSect">				<h3 class="nCLevel2">Base/original rules for displaying edit and delete links:</h3>				<p id="nCSect4Para1" class="nCPara14 nCSectPara1 nCLevel3">*true* =&gt; shouldDisplayEditAndDisplayLinks = false (10)</p>				<p id="nCSect4Para2" class="nCPara15 nCSectPara2 nCLevel3">(object.owner = session.current_user) =&gt; shouldDisplayEditAndDisplayLinks = true (50)</p>				</div>				<div id="nCSect5" class="nCSect">				<h3 class="nCLevel2">New rules to support editors editing objects:</h3>				<p id="nCSect5Para1" class="nCPara16 nCSectPara1 nCLevel3">(role = 'editor') =&gt; shouldDisplayEditAndDisplayLinks = true (100)</p>				</div>				<div id="nCSect6" class="nCSect">				<h3 class="nCLevel2">New rules for important exceptions to the above:</h3>				<p id="nCSect6Para1" class="nCPara17 nCSectPara1 nCLevel3">(entity.name = 'SecurityNotice') =&gt; shouldDisplayEditAndDisplayLinks = false (1000)</p>				<p id="nCSect6Para2" class="nCPara18 nCSectPara2 nCLevel3">((entity.name = 'SecurityNotice') and (role = 'manager')) =&gt; shouldDisplayEditAndDisplayLinks = true (1010)</p>				</div>				<p id="nCSect6Para3" class="nCPara19 nCSectPara3 nCLevel2">If we weren't using rules, we would have had to write some pretty complicated code to cover all of these (and future) cases, and duplicate that code in many places or augment the application design (in many places) to inherit/mixin the code, or augment the application design (in many places) to have an entry point that could call a centralized routine that implemented all that logic.</p>				<p id="nCSect6Para4" class="nCPara20 nCSectPara4 nCLevel2">When you think of all the places in your application you have complicated business rules that require application logic to implement, and how much the support of these business rules governs your application design to make it easy to implement/maintain, it becomes easy to see how this approach simplifies application design and improves productivity.</p>				</div>				<div id="nCSect7" class="nCSect">				<h2 class="nCLevel1">June 6, 2007</h2>				<p id="nCSect7Para1" class="nCPara21 nCSectPara1 nCLevel2">FYI, rules look something like this:</p>				<p id="nCSect7Para2" class="nCPara22 nCSectPara2 nCLevel2">*true* =&gt; itemHelperName = "DefaultItemHelper"</p>				<p id="nCSect7Para3" class="nCPara23 nCSectPara3 nCLevel2">(task = 'inspect') =&gt; itemHelperName = "InspectItemHelper"</p>				<p id="nCSect7Para4" class="nCPara24 nCSectPara4 nCLevel2">(task = 'list') =&gt; itemHelperName = "ListItemHelper"</p>				<p id="nCSect7Para5" class="nCPara25 nCSectPara5 nCLevel2">((task = 'list') and (entity.name = 'Post')) =&gt; itemHelperName = "MyCustomListPostHelper"</p>				<p id="nCSect7Para6" class="nCPara26 nCSectPara6 nCLevel2">Note that this example is VERY contrived for the purposes of a really simple example.  Presumably the first three rules would be supplied by a system that included generic scaffolding templates, and the last rule would be supplied by the application developer to provide more specific blog listing rendering functionality.</p>				<p id="nCSect7Para7" class="nCPara27 nCSectPara7 nCLevel2">Also note that I'm reusing some of Direct To Web's terminology above, specifically "task" and "entity".</p>				<p id="nCSect7Para8" class="nCPara28 nCSectPara8 nCLevel2">See Also: <a href="../../research/rules/background.html">Rails on Rules: Background</a></p>				<p id="nCSect7Para9" class="nCPara29 nCSectPara9 nCLevel2">Meaning: If a page listing objects from a collection wants to know which helper to use to render the item, it should use the ListItemHelper, unless it is listing blog posts, in which case it should use a MyCustomListPostHelper renderer.  If a template that just shows (inspects) a single object needed a helper, it would use an InspectItemHelper.  For other "tasks", the template should use a DefaultItemHelper.</p>				<p id="nCSect7Para10" class="nCPara30 nCSectPara10 nCLevel2">The template would look up the value of "itemHelperName" during rendering via a "Context" object.</p>				<p id="nCSect7Para11" class="nCPara31 nCSectPara11 nCLevel2">Rules have a left hand side (LHS) which is the boolean expression that determines if a rule should fire, and a right hand side (RHS) which specifies which key the LHS applies to, and what value should be returned when the rule is fired.</p>				<p id="nCSect7Para12" class="nCPara32 nCSectPara12 nCLevel2">I've left out a few details about how the rules work in the examples above.  For example, the value isn't limited to static values, you can specify an assignment class along with a rule which can supply a value when the rule is fired.  Also, rules are given a priority so that the system can determine which rule should fire in the case that more than one rule could apply.  Of course, base rules are given a lower priority than developer-supplied rules.</p>				</div>				</div>				</div>			<div id="left-column">				<div id="navigation">					<ul class="nav-links">						<li><a href="../../index.html">Home</a></li>						<li><a href="../../about.html">About</a></li>						<li><a href="../../contact.html">Contact</a></li>						<li><a href="../../links/index.html">Links</a></li>						<!-- <li><a href="../../software/index.html">Software</a></li> -->						<li><a href="../../research/index.html">Research</a></li>						<li><a href="http://jim.roepcke.com/">Jim's Weblog</a></li>						</ul>					</div>				</div>			</div>		<div id="footer">			<p class="update">				This page was last built on Mon, Jun 25, 2007 at 7:52:26 PM with <a href="http://frontierkernel.org/">Frontier</a> on <a href="http://macos.apple.com/">Mac OS X</a>. 				</p>			<p class="update">				Thanks for checking it out! Jim Roepcke				</p>			</div>		</body>	</html>